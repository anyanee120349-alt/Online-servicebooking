<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (PetCare Booking)</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* ---------------------------------- */
    /* CSS: Global, Layout & Navigation */
    /* ---------------------------------- */
    * { box-sizing: border-box; }
    body { font-family: 'Prompt', sans-serif; background-color: #eef2f7; padding: 30px 20px; color: #333; }
    .container { max-width: 1000px; margin: 0 auto; background: white; padding: 45px; border-radius: 16px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #004d99; margin-bottom: 35px; font-weight: 700; }
    .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid #ddd; flex-wrap: wrap;}
    .nav-left { font-size: 1.4em; font-weight: 700; color: #004d99; }
    .nav-left a { text-decoration: none; }
    .nav-left .home-link { padding: 10px 18px; border-radius: 8px; font-weight: 600; color: white; background-color: #004d99; margin-right: 15px; }
    
    /* **[‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á] nav-right ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏õ‡∏∏‡πà‡∏° Admin/Logout** */
    .nav-right { 
        display: flex; 
        flex-wrap: wrap; /* ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
        gap: 8px; /* **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á 8px ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°** */
        align-items: center;
    }
    
    .nav-right a { 
        padding: 10px 18px; 
        border-radius: 8px; 
        font-weight: 600; 
        color: white; 
        text-decoration: none; 
        transition: background-color 0.3s;
        display: inline-flex; /* ‡πÉ‡∏ä‡πâ flex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ icon ‡πÅ‡∏•‡∏∞ text ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        align-items: center;
    }
    
    .nav-right a i {
        margin-right: 6px;
    }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏° Admin (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å) */
    .nav-right .admin-core-link { 
        background-color: #007bff; /* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) */
    }
    .nav-right .daily-link { 
        background-color: #17a2b8; /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏ó‡∏≠‡∏£‡πå‡∏Ñ‡∏ß‡∏≠‡∏¢‡∏ã‡πå) */
    }
    .nav-right .member-link { 
        background-color: #28a745; /* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) */
    }

    .nav-right .user-dash-link { background-color: #ff9800; } 
    .nav-right .logout-link { background-color: #dc3545; } /* Logout (‡∏™‡∏µ‡πÅ‡∏î‡∏á) */
    .nav-right .admin-link { background-color: #5a6268; } /* ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Login/Logout/Admin ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
    

    /* ---------------------------------- */
    /* CSS: Form, Submission & Login/Register */
    /* ---------------------------------- */
    .section-header { background-color: #004d99; color: white; padding: 15px; border-radius: 8px; margin-bottom: 25px; font-weight: 700; text-align: center; }
    .form-group { margin-bottom: 25px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 0.95em; }
    input[type="text"], input[type="tel"], input[type="email"], input[type="date"], select, textarea, input[type="password"] { width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s; }
    input:focus, select:focus, textarea:focus { border-color: #007bff; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); outline: none; }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Fieldset ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà Login) */
    #bookingFormFieldset[disabled] { 
        opacity: 0.6; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏à‡∏≤‡∏á‡∏•‡∏á */
        pointer-events: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å */
    }
    
    input[disabled], select[disabled], textarea[disabled], button[disabled] { 
        background-color: #f1f1f1 !important; 
        color: #666 !important; 
        cursor: not-allowed !important; 
    }

    .submit-btn { background-color: #007bff; color: white; border: none; width: 100%; padding: 18px; border-radius: 8px; font-size: 1.1em; font-weight: 700; letter-spacing: 1px; cursor: pointer; transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s; }
    .submit-btn:hover { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4); }
    .error-message { color: #dc3545; font-size: 0.85em; margin-top: 5px; font-weight: 500; }
    .login-required-message { 
        text-align: center; 
        padding: 20px; 
        border: 2px dashed #ff9800; 
        background-color: #fff3e0; 
        color: #e65100; 
        border-radius: 10px; 
        margin-top: 20px;
        font-weight: 600;
        font-size: 1.1em;
    }

    /* Login Box Styles (Re-integrated) */
    .auth-box { max-width: 420px; margin: 0 auto; padding: 40px; background: #ffffff; border-radius: 15px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15); border-top: 5px solid #ff9800; }
    .auth-box h2 { color: #e65100; font-size: 1.8em; }
    .auth-box.admin { border-top-color: #007bff; }
    .auth-box.admin h2 { color: #004d99; }
    .auth-box .btn-login { background-color: #28a745; }
    .auth-box .btn-register { background-color: #ff9800; margin-top: 10px;}
    #authMessage { padding: 10px; border-radius: 6px; margin-top: 20px; font-weight: 600; text-align: center;}
    .msg-success { background-color: #d4edda; color: #155724; }
    .msg-error { background-color: #f8d7da; color: #721c24; }
    .msg-loading { background-color: #f7f9fb; color: #007bff; }
    
    /* ---------------------------------- */
    /* CSS: User & Admin Dashboard List */
    /* ---------------------------------- */
    #adminContent table { 
        width: 100%; 
        border-collapse: collapse; 
        border: 1px solid #e0e0e0; 
        border-radius: 8px; 
        overflow: hidden; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
    }
    #adminContent th { 
        background-color: #004d99; 
        color: white; 
        padding: 12px 10px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        font-weight: 600; 
        font-size: 0.9em; 
        text-align: left; 
    }
    #adminContent td { 
        padding: 12px 10px; /* **[‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á] ‡πÄ‡∏û‡∏¥‡πà‡∏° Padding ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á** */
        font-size: 0.85em; /* **[‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á] ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î Font ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà** */
        border-bottom: 1px solid #f0f0f0; 
        white-space: nowrap; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
    }
    #adminContent tr:nth-child(even) { background-color: #f7f9fb; }
    
    /* **[‡πÉ‡∏´‡∏°‡πà] ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°** */
    #adminContent table th:nth-child(1), 
    #adminContent table td:nth-child(1) { 
        width: 12%; /* Timestamp */
        font-size: 0.8em; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏π‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
    }
    #adminContent table th:nth-child(2), 
    #adminContent table td:nth-child(2) { 
        width: 10%; /* BookingId */
        font-weight: 600;
        color: #007bff;
    }
    #adminContent table th:nth-child(3), 
    #adminContent table td:nth-child(3) { 
        width: 10%; /* Status */
    }
    #adminContent table th:nth-child(9), 
    #adminContent table td:nth-child(9) { 
        width: 8%; /* ‡πÄ‡∏ß‡∏•‡∏≤ */
    }
    #adminContent table th:nth-child(10), 
    #adminContent table td:nth-child(10) { 
        width: 10%; /* Action */
    }


    .status-badge { font-weight: 600; padding: 4px 10px; border-radius: 12px; white-space: nowrap; }
    .status-‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô { background-color: #ffc107; color: #333; }
    .status-‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß { background-color: #28a745; color: white; }
    .status-Registered { background-color: #007bff; color: white; }
    .status-‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å { background-color: #ff5722; color: white; } 

    .user-profile-box { background: #e6f7ff; border: 1px solid #91d5ff; padding: 20px; border-radius: 10px; margin-bottom: 25px; }
    .user-card-header { 
        background-color: #f0fdf4; 
        padding: 15px; 
        border-radius: 8px 8px 0 0; 
        border: 1px solid #d4edda; 
        border-bottom: none; 
        font-weight: 700; 
        color: #1e7e34;
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        flex-wrap: wrap;
    }
    .user-card-header span {
        white-space: nowrap;
    }
    .user-card-body { 
        padding: 15px; 
        display: grid; 
        grid-template-columns: 1fr 2fr 1fr; 
        gap: 10px; 
        border-bottom: 1px solid #eee;
    }
    .user-card-footer { 
        padding: 10px 15px; 
        background-color: #f7f9fb; 
        border-radius: 0 0 8px 8px;
        display: flex; 
        justify-content: space-between; 
        align-items: center;
    }

    /* **Daily View Styles** */
    .daily-booking-card { 
        background-color: #fff; 
        border: 1px solid #e0e0e0; 
        padding: 20px; 
        border-radius: 10px; 
        margin-bottom: 15px; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
        display: grid; 
        grid-template-columns: 1fr 3fr; 
        gap: 15px; 
        align-items: center; 
    }
    .card-time { 
        font-size: 1.8em; 
        font-weight: 700; 
        color: #004d99; 
        text-align: center; 
        border-right: 2px solid #f0f0f0; 
        padding-right: 15px; 
    }
  </style>
</head>
<body>

<div class="container">
  
<div class="nav-bar">
    <div class="nav-left">
        <a href="#booking" onclick="showPage('booking')" class="home-link">
             <i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å
        </a>
        <span>
            <i class="fas fa-hand-holding-medical"></i> PetCare Booking
        </span>
    </div>
    <div class="nav-right">
        
        <a href="#admin" onclick="showPage('admin')" class="admin-core-link" id="adminDashboardLink" style="display:none;">
            <i class="fas fa-tasks"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </a>
        <a href="#daily" onclick="showPage('daily')" class="daily-link" id="dailyViewLink" style="display:none;">
            <i class="fas fa-calendar-day"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
        </a>
        <a href="#members" onclick="showPage('members')" class="member-link" id="memberListLink" style="display:none;">
            <i class="fas fa-users"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        </a>
        
        <a href="#user" onclick="showPage('user')" class="user-dash-link" id="userDashboardLink" style="display:none;">
            <i class="fas fa-user-circle"></i> ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
        </a>

        <a href="#login" onclick="showPage('login')" class="admin-link" id="unifiedLoginLink">
            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        </a>
        <a href="#" onclick="doLogout()" class="logout-link" id="unifiedLogoutLink" style="display:none;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
</div>
    
    <div id="bookingContent" class="page-content">
        <h2><i class="fas fa-calendar-alt"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå - ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå</h2>
        
        <div id="loginRequiredMessage" class="login-required-message" style="display: none;">
             <i class="fas fa-exclamation-triangle"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß
        </div>

        <fieldset id="bookingFormFieldset" disabled> 
            <form id="bookingForm">
                <div class="section-header"><i class="fas fa-user-tag"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group"><label for="ownerName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label><input type="text" id="ownerName" name="ownerName" required data-validation="name"><div class="error-message" id="ownerNameError"></div></div>
                    <div class="form-group"><label for="ownerTel">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</label><input type="tel" id="ownerTel" name="ownerTel" required data-validation="tel" maxlength="10"><div class="error-message" id="ownerTelError"></div></div>
                    <div class="form-group" style="grid-column: 1 / 3;"><label for="ownerEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label><input type="email" id="ownerEmail" name="ownerEmail" required data-validation="email"><div class="error-message" id="ownerEmailError"></div></div>
                </div>
                <div class="section-header"><i class="fas fa-paw"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div class="form-group"><label for="petName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á:</label><input type="text" id="petName" name="petName" required></div>
                    <div class="form-group"><label for="petSpecies">‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå:</label><select id="petSpecies" name="petSpecies" required><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå --</option><option value="‡∏´‡∏°‡∏≤">‡∏´‡∏°‡∏≤ (Dog)</option><option value="‡πÅ‡∏°‡∏ß">‡πÅ‡∏°‡∏ß (Cat)</option><option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Other)</option></select></div>
                    <div class="form-group"><label for="petBreed">‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå:</label><input type="text" id="petBreed" name="petBreed" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÇ‡∏Å‡∏•‡πÄ‡∏î‡πâ‡∏ô"></div>
                </div>
                <div class="section-header"><i class="fas fa-clock"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</div>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 20px;">
                    <div class="form-group"><label for="serviceType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</label><select id="serviceType" name="serviceType" required><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ --</option><option value="A: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">A: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option><option value="B: ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á">B: ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á</option><option value="C: ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥-‡∏ï‡∏±‡∏î‡∏Ç‡∏ô">C: ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥-‡∏ï‡∏±‡∏î‡∏Ç‡∏ô</option></select></div>
                    <div class="form-group"><label for="bookingDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label><input type="date" id="bookingDate" name="bookingDate" required></div>
                    <div class="form-group"><label for="bookingTime">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</label><select id="bookingTime" name="bookingTime" required><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ --</option><option value="09:00">09:00</option><option value="10:00">10:00</option><option value="11:00">11:00</option></select></div>
                </div>
                <div class="form-group"><label for="notes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡πà‡∏ß‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°):</label><textarea id="notes" name="notes" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©"></textarea></div>
                <button type="submit" class="submit-btn"><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
            </form>
        </fieldset>
    </div>
    
    <div id="loading" style="text-align: center; color: #004d99; font-weight: 600; margin-top: 20px; display: none;">üê∂ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</div>

    <div id="loginContent" class="page-content" style="display:none;">
        <div id="loginRegisterBox" class="auth-box">
             </div>
    </div>
    
    <div id="confirmationContent" class="page-content" style="display:none;">
        <div class="confirmation-box" style="text-align: center;">
            <div style="color: #28a745; font-size: 6em; margin-bottom: 25px;"><i class="fas fa-calendar-check"></i></div>
            <h2>‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!</h2>
            <p style="font-size: 1.1em; color: #555;">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <div id="confirmedBookingId" class="booking-id-display" style="font-size: 1.5em; font-weight: 700; color: #004d99; margin: 10px 0;"></div>
            <p style="margin-top: 30px;">
                <a href="#user" onclick="showPage('user')" class="submit-btn" style="width: auto; padding: 12px 25px; display: inline-block;"><i class="fas fa-user-circle"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
            </p>
        </div>
    </div>

    <div id="userContent" class="page-content" style="display:none;">
        <h2><i class="fas fa-user-circle"></i> ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
        <p style="font-size: 1.1em; font-weight: 600; color: #004d99; margin-bottom: 20px; text-align: center;">
            ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, <span id="currentUserName">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>!
        </p>
        <div id="userBookingsList">
            </div>
    </div>

    <div id="adminContent" class="page-content" style="display:none;">
        <h2><i class="fas fa-tasks"></i> ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <p style="text-align: right; color: #004d99; font-weight: 600; margin-bottom: 15px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="recordCount"></span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
        <div id="adminTableContainer" style="overflow-x: auto;"></div>
    </div>

    <div id="dailyContent" class="page-content" style="display:none;">
        <h2><i class="fas fa-calendar-day"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß)</h2>
        <div id="dailyFilter" style="display: flex; justify-content: center; align-items: center; margin-bottom: 30px; background-color: #f5f5f5; padding: 20px; border-radius: 10px;">
            <label for="dailyDateInput" style="margin-right: 15px; font-size: 1.1em; color: #004d99; font-weight: 700;"><i class="fas fa-calendar-check"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á):</label>
            <input type="date" id="dailyDateInput" style="width: 250px; padding: 10px; border: 1px solid #ddd;">
        </div>
        <div id="dailyCount" style="font-weight: 600; text-align: center; margin-bottom: 20px; font-size: 1.1em;"></div>
        <div id="dailyBookingsList">
            </div>
    </div>
    
    <div id="membersContent" class="page-content" style="display:none;">
        <h2><i class="fas fa-users"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</h2>
        <div id="memberControlPanel" style="margin-bottom: 25px;">
            <input type="text" id="memberSearchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£/‡∏≠‡∏µ‡πÄ‡∏°‡∏•/‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á..." 
                   style="width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px;">
        </div>
        <div id="memberCount" style="font-weight: 600; margin-bottom: 15px;"></div>
        <div id="memberProfilesList">
            </div>
    </div>
</div> 

<script>
    // **********************************************
    // GLOBAL CONFIGURATION & SECRETS 
    // **********************************************
    const STORAGE_KEY = 'pet_bookings_vscodesim';
    const ADMIN_PASSWORD = '123456'; 
    const ADMIN_TOKEN_KEY = 'admin_session_token';
    const USER_TEL_KEY = 'user_session_tel';
    const MAX_BOOKINGS_PER_HOUR = 3; 

    const bookingForm = document.getElementById('bookingForm');
    const bookingFormFieldset = document.getElementById('bookingFormFieldset'); 
    const loginRequiredMessage = document.getElementById('loginRequiredMessage'); 
    const dailyDateInput = document.getElementById('dailyDateInput');

    // **********************************************
    // 1. Core Logic (Local Storage Simulation)
    // **********************************************

    function loadBookings() {
        const json = localStorage.getItem(STORAGE_KEY);
        try {
             const data = json ? JSON.parse(json) : [];
             if (!Array.isArray(data)) return [];
             return data;
        } catch (e) {
            return [];
        }
    }

    function saveBookings(bookings) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(bookings));
    }

    function generateId() {
        return Math.random().toString(36).substring(2, 10).toUpperCase();
    }
    
    function simulateProcessForm(formData) {
        const bookings = loadBookings();
        const bookingId = generateId();
        const timestamp = new Date().toLocaleString('th-TH');

        const newRecord = {
            Timestamp: timestamp,
            BookingId: bookingId,
            Status: '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
            OwnerName: formData.ownerName,
            OwnerTel: formData.ownerTel,
            OwnerEmail: formData.ownerEmail,
            PetName: formData.petName,
            ServiceType: formData.serviceType,
            BookingDate: formData.bookingDate,
            BookingTime: formData.bookingTime,
            PetSpecies: formData.petSpecies, 
            PetBreed: formData.petBreed,
            Notes: formData.notes
        };

        const isRegistered = bookings.some(record => record.OwnerTel === formData.ownerTel && record.Status === 'Registered');
        
        if (!isRegistered) {
             const newRegistration = {
                Timestamp: timestamp,
                BookingId: 'USER_REG', 
                Status: 'Registered',
                OwnerName: formData.ownerName,
                OwnerTel: formData.ownerTel,
                OwnerEmail: formData.ownerEmail,
                PetName: 'N/A',
                ServiceType: 'N/A',
                BookingDate: 'N/A',
                BookingTime: 'N/A'
            };
            bookings.push(newRegistration);
        }

        bookings.push(newRecord);
        saveBookings(bookings);
        
        return { success: true, bookingId: bookingId };
    }
    
    function getAdminSession() {
        return localStorage.getItem(ADMIN_TOKEN_KEY);
    }
    
    function getUserSession() {
        return localStorage.getItem(USER_TEL_KEY);
    }

    function doLogout() {
        localStorage.removeItem(ADMIN_TOKEN_KEY);
        localStorage.removeItem(USER_TEL_KEY);
        
        resetBookingForm(); 
        
        // ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (booking) ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° Navigation
        showPage('booking'); 
    }

    function confirmBooking(bookingId) {
        if (!getAdminSession()) {
             alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin');
             showPage('login');
             return;
        }

        if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏¥‡∏ß‡∏£‡∏´‡∏±‡∏™: ${bookingId} ?`)) return;

        const bookings = loadBookings();
        const index = bookings.findIndex(record => record.BookingId === bookingId);

        if (index !== -1) {
            bookings[index].Status = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
            saveBookings(bookings);
            alert(`‡∏Ñ‡∏¥‡∏ß ${bookingId} ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`);
            
            if (document.getElementById('adminContent').style.display === 'block') {
                displayAdminBookings();
            } else if (document.getElementById('dailyContent').style.display === 'block') {
                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                dailyDateInput.value ? displayDailyBookings(dailyDateInput.value) : displayAllConfirmedBookings();
            }
        }
    }

    function cancelBooking(bookingId) {
        if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏´‡∏±‡∏™: ${bookingId} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`)) return;

        const bookings = loadBookings();
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ BookingId ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏≠‡∏Å
        const updatedBookings = bookings.filter(record => record.BookingId !== bookingId);

        if (updatedBookings.length < bookings.length) {
            saveBookings(updatedBookings);
            alert(`‚úÖ ‡∏Ñ‡∏¥‡∏ß ${bookingId} ‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            
            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤ User Dashboard
            displayUserBookings(getUserSession());
        } else {
             alert(`‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏£‡∏´‡∏±‡∏™ ${bookingId} ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ`);
        }
    }
    
    function requestCancelBooking(bookingId) {
        if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏´‡∏±‡∏™: ${bookingId} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Admin`)) return;

        const bookings = loadBookings();
        const index = bookings.findIndex(record => record.BookingId === bookingId);

        if (index !== -1 && bookings[index].Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß') {
            bookings[index].Status = '‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô '‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            saveBookings(bookings);
            alert(`‚úÖ ‡∏Ñ‡∏¥‡∏ß ${bookingId} ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà`);
            
            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤ User Dashboard
            displayUserBookings(getUserSession());
        } else {
             alert(`‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏£‡∏´‡∏±‡∏™ ${bookingId} ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á`);
        }
    }
    
    function approveCancelBooking(bookingId) {
        if (!getAdminSession()) {
             alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin');
             showPage('login');
             return;
        }

        if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß‡∏£‡∏´‡∏±‡∏™: ${bookingId} ? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö`)) return;

        const bookings = loadBookings();
        
        // ‡∏•‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö cancelBooking ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        const updatedBookings = bookings.filter(record => record.BookingId !== bookingId);

        if (updatedBookings.length < bookings.length) {
            saveBookings(updatedBookings);
            alert(`‚úÖ ‡∏Ñ‡∏¥‡∏ß ${bookingId} ‡∏ñ‡∏π‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß!`);
            
            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤ Admin/Daily
            if (document.getElementById('adminContent').style.display === 'block') {
                displayAdminBookings();
            } else if (document.getElementById('dailyContent').style.display === 'block') {
                dailyDateInput.value ? displayDailyBookings(dailyDateInput.value) : displayAllConfirmedBookings();
            }
        }
    }

    // **********************************************
    // 2. Navigation and Page Display
    // **********************************************
    
    function updateNavLinks() {
        const isLoggedInAdmin = !!getAdminSession();
        const isLoggedInUser = !!getUserSession(); 
        const isLoggedIn = isLoggedInAdmin || isLoggedInUser;
        
        // ‡∏õ‡∏∏‡πà‡∏° Login/Logout ‡∏´‡∏•‡∏±‡∏Å
        document.getElementById('unifiedLoginLink').style.display = isLoggedIn ? 'none' : 'inline-block';
        document.getElementById('unifiedLogoutLink').style.display = isLoggedIn ? 'inline-block' : 'none';
        
        // Admin Links
        document.getElementById('adminDashboardLink').style.display = isLoggedInAdmin ? 'inline-flex' : 'none';
        document.getElementById('dailyViewLink').style.display = isLoggedInAdmin ? 'inline-flex' : 'none'; 
        document.getElementById('memberListLink').style.display = isLoggedInAdmin ? 'inline-flex' : 'none'; 
        
        // User Links
        document.getElementById('userDashboardLink').style.display = isLoggedInUser ? 'inline-flex' : 'none';

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°
        if (isLoggedInUser) {
             document.getElementById('adminDashboardLink').style.display = 'none';
             document.getElementById('dailyViewLink').style.display = 'none';
             document.getElementById('memberListLink').style.display = 'none';
        }
        if (isLoggedInAdmin) {
             document.getElementById('userDashboardLink').style.display = 'none';
        }
    }

    function showPage(pageId, data = null) {
        document.querySelectorAll('.page-content').forEach(div => {
            div.style.display = 'none';
        });

        document.getElementById('loading').style.display = 'none';
        
        // Guard: Admin Access
        if ((pageId === 'admin' || pageId === 'daily' || pageId === 'members') && !getAdminSession()) { 
             alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤ Admin');
             showPage('login');
             return; 
        }

        // Guard: User Access
        if (pageId === 'user' && !getUserSession()) {
             alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
             showPage('login'); 
             return; 
        }

        if (pageId === 'booking') {
            document.getElementById('bookingContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
             prefillBookingForm(); 
        } else if (pageId === 'confirmation') {
            document.getElementById('confirmedBookingId').textContent = data;
            document.getElementById('confirmationContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        } else if (pageId === 'admin') {
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (Admin)';
            displayAdminBookings(); 
        } else if (pageId === 'daily') {
            document.getElementById('dailyContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß)';
            
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
            dailyDateInput.value = ''; 
            displayAllConfirmedBookings();
            
        } else if (pageId === 'members') { 
            document.getElementById('membersContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
            document.getElementById('memberSearchInput').value = '';
            displayMemberProfiles();
            
        } else if (pageId === 'user') {
            document.getElementById('userContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
            displayUserBookings(getUserSession());
        } else if (pageId === 'login') {
            document.getElementById('loginContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö/‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
            showLoginForm(); 
        } else if (pageId === 'register') {
             document.getElementById('loginContent').style.display = 'block';
             document.getElementById('pageTitle').textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà';
             showRegisterForm();
        }
        
        window.location.hash = pageId; 
        updateNavLinks(); 
    }

    window.onload = function() {
        const hash = window.location.hash.substring(1);
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('bookingDate').min = today;
        
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á Daily Date Input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤
        dailyDateInput.value = ''; 
        
        if (hash === 'status') { // Handle removed status page
             showPage('booking');
             return;
        }

        if ((getAdminSession() && (hash === 'admin' || hash === 'daily' || hash === 'members')) || (getUserSession() && hash === 'user')) { 
            showPage(hash);
        } else if (hash) {
            showPage(hash);
        } else {
             showPage('booking');
        }
        
        // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Event Listener: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å displayDailyBookings ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å displayAllConfirmedBookings ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        dailyDateInput.addEventListener('change', (e) => {
            const selectedDate = e.target.value;
            if (selectedDate) {
                 displayDailyBookings(selectedDate); // ‡∏î‡∏π‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            } else {
                 displayAllConfirmedBookings(); // ‡∏´‡∏≤‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            }
        });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        const memberSearchInput = document.getElementById('memberSearchInput');
        memberSearchInput.addEventListener('keyup', (e) => {
             displayMemberProfiles(e.target.value.trim());
        });
    };
    
    // **********************************************
    // 3. Login/Register Form Logic 
    // **********************************************

    function showLoginForm(isAdmin = false) {
        const box = document.getElementById('loginRegisterBox');
        box.className = isAdmin ? 'auth-box admin' : 'auth-box';
        const title = isAdmin ? '<i class="fas fa-lock"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '<i class="fas fa-user-check"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
        const placeholder = isAdmin ? '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•' : '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)';
        const inputType = isAdmin ? 'password' : 'tel';
        const action = isAdmin ? 'doAdminLogin(event)' : 'doUserLogin(event)';
        
        box.innerHTML = `
            <h2>${title}</h2>
            <form onsubmit="${action}">
                <div class="form-group">
                    <label for="authInput">${isAdmin ? '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô' : '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå'}:</label>
                    <input type="${inputType}" id="authInput" placeholder="${placeholder}" required maxlength="${isAdmin ? '10' : '10'}">
                </div>
                <button type="submit" class="submit-btn btn-login" style="background-color: ${isAdmin ? '#007bff' : '#28a745'};">
                    <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
            <div id="authMessage"></div>
            ${!isAdmin ? `<a href="#" onclick="showRegisterForm()" style="display: block; text-align: center; margin-top: 20px; color: #ff9800; font-weight: 600;">
                <i class="fas fa-user-plus"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            </a>
            <a href="#" onclick="showLoginForm(true)" style="display: block; text-align: center; margin-top: 10px; color: #5a6268; font-weight: 600;">
                <i class="fas fa-user-shield"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
            </a>` : `<a href="#" onclick="showLoginForm(false)" style="display: block; text-align: center; margin-top: 20px; color: #28a745; font-weight: 600;">
                <i class="fas fa-user"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
            </a>`}
        `;
    }

    function showRegisterForm() {
        const box = document.getElementById('loginRegisterBox');
        box.className = 'auth-box';
        box.style.maxWidth = '500px'; 
        
        box.innerHTML = `
            <h2><i class="fas fa-user-plus"></i> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å PetCare</h2>
            <p style="text-align: center; color: #6c757d; margin-bottom: 20px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p>
            <form onsubmit="doRegister(event)">
                <div class="form-group">
                    <label for="regName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
                    <input type="text" id="regName" required>
                </div>
                <div class="form-group">
                    <label for="regTel">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô):</label>
                    <input type="tel" id="regTel" required maxlength="10">
                </div>
                <div class="form-group">
                    <label for="regEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
                    <input type="email" id="regEmail" required>
                </div>
                <button type="submit" class="submit-btn btn-register">
                    <i class="fas fa-user-check"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                </button>
            </form>
            <div id="authMessage"></div>
            <a href="#" onclick="showLoginForm(false)" class="back-btn" style="display: block; text-align: center; margin-top: 15px; color: #28a745; font-weight: 600;"><i class="fas fa-chevron-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        `;
    }

    function doAdminLogin(e) {
        e.preventDefault();
        const password = document.getElementById('authInput').value;
        const msgDiv = document.getElementById('authMessage');
        msgDiv.className = 'msg-loading';
        msgDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

        setTimeout(() => {
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem(ADMIN_TOKEN_KEY, ADMIN_PASSWORD); 
                localStorage.removeItem(USER_TEL_KEY); 
                resetBookingForm(); 
                msgDiv.className = 'msg-success';
                msgDiv.innerHTML = '‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤...';
                setTimeout(() => { showPage('admin'); }, 500); 
            } else {
                msgDiv.className = 'msg-error';
                msgDiv.innerHTML = `‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;
            }
        }, 500);
    }

    function doUserLogin(e) {
        e.preventDefault();
        const tel = document.getElementById('authInput').value.trim();
        const msgDiv = document.getElementById('authMessage');
        const bookings = loadBookings();
        
        msgDiv.className = 'msg-loading';
        msgDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

        const existingUser = bookings.some(record => record.OwnerTel === tel && record.Status !== 'N/A');

        setTimeout(() => {
            if (existingUser) {
                localStorage.setItem(USER_TEL_KEY, tel); 
                localStorage.removeItem(ADMIN_TOKEN_KEY); 
                
                prefillBookingForm(tel); 
                
                msgDiv.className = 'msg-success';
                msgDiv.innerHTML = '‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤...';
                setTimeout(() => { showPage('user'); }, 500); 
            } else {
                msgDiv.className = 'msg-error';
                msgDiv.innerHTML = `‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô)`;
            }
        }, 800);
    }
    
    function doRegister(e) {
        e.preventDefault();
        const name = document.getElementById('regName').value.trim();
        const tel = document.getElementById('regTel').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const msgDiv = document.getElementById('authMessage');
        const bookings = loadBookings();
        
        msgDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';
        msgDiv.className = 'msg-loading';

        if (tel.length !== 10 || isNaN(tel)) {
             msgDiv.className = 'msg-error';
             msgDiv.innerHTML = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (10 ‡∏´‡∏•‡∏±‡∏Å)';
             return;
        }

        const isRegistered = bookings.some(record => record.OwnerTel === tel && record.Status === 'Registered');

        if (isRegistered) {
            msgDiv.className = 'msg-error';
            msgDiv.innerHTML = '‚ùå ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            return;
        }
        
        setTimeout(() => {
            const newRegistration = {
                Timestamp: new Date().toLocaleString('th-TH'),
                BookingId: 'USER_REG', 
                Status: 'Registered',
                OwnerName: name,
                OwnerTel: tel,
                OwnerEmail: email,
                PetName: 'N/A',
                ServiceType: 'N/A',
                BookingDate: 'N/A',
                BookingTime: 'N/A'
            };

            bookings.push(newRegistration);
            saveBookings(bookings);
            
            msgDiv.className = 'msg-success';
            msgDiv.innerHTML = `üéâ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...`;
            
            setTimeout(() => {
                showLoginForm(false); 
            }, 1500); 

        }, 1000);
    }

    // **********************************************
    // 4. Form Prefill/Lock Logic
    // **********************************************
    
    function findUserProfile(tel) {
        const bookings = loadBookings();
        return bookings.find(record => record.OwnerTel === tel && record.Status === 'Registered');
    }

    function prefillBookingForm(tel = getUserSession()) {
        const nameInput = document.getElementById('ownerName');
        const telInput = document.getElementById('ownerTel');
        const emailInput = document.getElementById('ownerEmail');

        if (tel) {
            const userProfile = findUserProfile(tel);
            if (userProfile) {
                // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ Fieldset ‡∏´‡∏•‡∏±‡∏Å
                bookingFormFieldset.disabled = false;
                loginRequiredMessage.style.display = 'none';

                // ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡πà‡∏≠‡∏á
                nameInput.value = userProfile.OwnerName || '';
                telInput.value = userProfile.OwnerTel || '';
                emailInput.value = userProfile.OwnerEmail || '';
                
                nameInput.disabled = true;
                telInput.disabled = true;
                emailInput.disabled = true;
                
                document.getElementById('ownerNameError').textContent = '‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                document.getElementById('ownerNameError').style.color = '#28a745';
                return;
            }
        }
        
        // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Login ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‡πÉ‡∏´‡πâ Reset/Lock
        resetBookingForm();
    }

    function resetBookingForm() {
        const nameInput = document.getElementById('ownerName');
        const telInput = document.getElementById('ownerTel');
        const emailInput = document.getElementById('ownerEmail');

        // ‡∏•‡πá‡∏≠‡∏Ñ Fieldset ‡∏´‡∏•‡∏±‡∏Å
        bookingFormFieldset.disabled = true;
        loginRequiredMessage.style.display = 'block';

        // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ input ‡∏¢‡πà‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤
        nameInput.disabled = false;
        telInput.disabled = false;
        emailInput.disabled = false;
        
        nameInput.value = '';
        telInput.value = '';
        emailInput.value = '';
        
        document.getElementById('ownerNameError').textContent = '';
    }

    // **********************************************
    // 5. Display Functions (Admin/User/Daily/Members)
    // **********************************************

    function displayUserBookings(ownerTel) {
        const allBookings = loadBookings();
        const userBookingsList = document.getElementById('userBookingsList');
        
        const userProfileRecord = allBookings.find(record => record.OwnerTel === ownerTel && record.Status === 'Registered') 
                                 || allBookings.find(record => record.OwnerTel === ownerTel);
        
        const userName = userProfileRecord ? userProfileRecord.OwnerName : '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
        document.getElementById('currentUserName').textContent = userName;
        
        const filteredRecords = allBookings
            .filter(record => record.OwnerTel === ownerTel && record.Status !== 'Registered' && record.Status !== 'N/A')
            .sort((a, b) => new Date(a.BookingDate) - new Date(b.BookingDate));

        let profileHTML = `
            <div class="user-profile-box">
                <h3 style="color: #0056b3;"><i class="fas fa-id-card"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${userName}</p>
                <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> ${ownerTel}</p>
                <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${userProfileRecord ? userProfileRecord.OwnerEmail : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p>
            </div>
        `;
        
        let bookingsListHTML = '<h3><i class="fas fa-calendar-check"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</h3>';

        if (filteredRecords.length === 0) {
            bookingsListHTML += `
                <div class="user-booking-item">
                    <div class="user-card-header" style="background-color: #ffe0b2; color: #ef6c00;">
                        <span style="font-weight: 700; color: #ef6c00;">
                            <i class="fas fa-calendar-times"></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                        </span>
                    </div>
                    <p style="text-align: center; color: #6c757d; padding: 20px;">
                        ‡∏Ñ‡∏∏‡∏ì ${userName} ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
                    </p>
                </div>`;
        } else {
             filteredRecords.forEach(record => {
                const statusClass = `status-${record.Status.replace(/\s/g, '')}`;
                const notesDisplay = record.Notes ? `<span style="font-style: italic; color: #888;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${record.Notes}</span>` : '';
                
                let cancelButtonHTML = '';
                if (record.Status === '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô') {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    cancelButtonHTML = `
                        <button onclick="cancelBooking('${record.BookingId}')" 
                                style="background-color: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-times-circle"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß
                        </button>
                    `;
                } else if (record.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß') {
                     // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß: ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                     cancelButtonHTML = `
                        <button onclick="requestCancelBooking('${record.BookingId}')" 
                                style="background-color: #ff9800; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-exclamation-triangle"></i> ‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    `;
                } else if (record.Status === '‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å') {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å: ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    cancelButtonHTML = `
                        <span style="color: #ff5722; font-weight: 600;"><i class="fas fa-hourglass-half"></i> ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                    `;
                }

                bookingsListHTML += `
                    <div class="user-booking-item">
                        <div class="user-card-header">
                            <span style="font-weight: 700; color: #1e7e34;">
                                <i class="fas fa-paw"></i> ${record.PetName} (‡∏ä‡∏ô‡∏¥‡∏î: ${record.PetSpecies || '-'})
                            </span>
                            <span style="font-weight: 500; color: #007bff; font-size: 0.9em;">
                                <i class="fas fa-calendar-alt"></i> ${record.BookingDate} <i class="fas fa-clock"></i> ${record.BookingTime}
                            </span>
                        </div>
                        <div class="user-card-body">
                            <div><strong>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏¥‡∏ß:</strong> ${record.BookingId}</div>
                            <div><strong>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á:</strong> ${record.ServiceType}</div>
                            <div><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span class="status-badge ${statusClass}">${record.Status}</span></div>
                        </div>
                        <div class="user-card-footer">
                            <div>${notesDisplay}</div>
                            <div>${cancelButtonHTML}</div>
                        </div>
                    </div>
                `;
            });
        }
        
        userBookingsList.innerHTML = profileHTML + bookingsListHTML;
    }

    
    function displayAdminBookings() {
       const records = loadBookings();
        const container = document.getElementById('adminTableContainer');
        document.getElementById('recordCount').textContent = `${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        
        if (records.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px; border: 1px dashed #ccc; border-radius: 8px;">‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
            return;
        }

        const displayRecords = records.filter(r => r.BookingId !== 'USER_REG').slice().reverse();

        const headersToDisplay = ['Timestamp', 'BookingId', 'Status', 'OwnerName', 'OwnerTel', 'PetName', 'ServiceType', 'BookingDate', 'BookingTime', 'Action'];
        const thaiHeaders = {
            Timestamp: '‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á', BookingId: '‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≠‡∏á', Status: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', OwnerName: '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á', OwnerTel: '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', PetName: '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', ServiceType: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', BookingDate: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', BookingTime: '‡πÄ‡∏ß‡∏•‡∏≤', Action: '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'
        };

        let tableHTML = '<table><thead><tr>';
        headersToDisplay.forEach(header => { tableHTML += `<th>${thaiHeaders[header] || header}</th>`; });
        tableHTML += '</tr></thead><tbody>';
        
        displayRecords.forEach(record => {
            tableHTML += '<tr>';
            headersToDisplay.forEach(header => {
                let displayValue = record[header] || '-';
                if (header === 'Status') {
                    const className = `status-${displayValue.replace(/\s/g, '')}`;
                    displayValue = `<span class="status-badge ${className}">${displayValue}</span>`;
                } else if (header === 'Action') {
                    if (record.Status === '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô') {
                        displayValue = `<button class="action-btn btn-confirm" onclick="confirmBooking('${record.BookingId}')">
                            <i class="fas fa-check"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                        </button>`;
                    } else if (record.Status === '‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å') {
                        displayValue = `<button class="action-btn" onclick="approveCancelBooking('${record.BookingId}')" style="background-color: #dc3545;">
                            <i class="fas fa-trash-alt"></i> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>`;
                    } else {
                        displayValue = `<button class="action-btn btn-disabled"><i class="fas fa-check-double"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>`;
                    }
                }
                tableHTML += `<td>${displayValue}</td>`;
            });
            tableHTML += '</tr>';
        });
        
        tableHTML += '</tbody></table>';
        container.innerHTML = tableHTML;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠)
    function displayAllConfirmedBookings() {
        const allBookings = loadBookings();
        const dailyBookingsList = document.getElementById('dailyBookingsList');
        const dailyCount = document.getElementById('dailyCount');

        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' 
        let confirmedRecords = allBookings
            .filter(record => record.BookingId !== 'USER_REG' && record.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
            
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (Descending) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ dateB - dateA
        confirmedRecords.sort((a, b) => {
            const dateA = new Date(a.BookingDate + 'T' + a.BookingTime);
            const dateB = new Date(b.BookingDate + 'T' + b.BookingTime);
            return dateB - dateA; // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î
        });

        dailyCount.textContent = `üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${confirmedRecords.length} ‡∏Ñ‡∏¥‡∏ß (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î)`;

        if (confirmedRecords.length === 0) {
            dailyBookingsList.innerHTML = `
                <p style="text-align: center; color: #6c757d; padding: 20px; border: 1px dashed #ccc; border-radius: 8px;">
                    ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                </p>`;
            return;
        }

        let cardsHTML = '';
        confirmedRecords.forEach(record => {
            const actionButton = `<button class="action-btn btn-disabled" style="margin-top: 10px; background-color: #28a745;">
                    <i class="fas fa-check-double"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                </button>`;

            cardsHTML += `
                <div class="daily-booking-card">
                    <div class="card-time">
                        ${record.BookingDate.split('-').reverse().join('/')} 
                        <br>
                        <span style="font-size: 0.6em; font-weight: 400;">${record.BookingTime} ‡∏ô.</span>
                        <div class="status-badge status-‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß" style="font-size: 0.5em; margin-top: 5px; display: block;">${record.Status}</div>
                    </div>
                    <div class="card-details">
                        <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏¥‡∏ß:</strong> ${record.BookingId}</p>
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</strong> ${record.OwnerName} (<span style="color: #007bff;">${record.OwnerTel}</span>)</p>
                        <p><strong>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</strong> ${record.ServiceType}</p>
                        <p style="font-size: 0.9em; color: #6c757d;">
                            <i class="fas fa-paw"></i> ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á: ${record.PetName}
                        </p>
                        ${actionButton}
                    </div>
                </div>
            `;
        });

        dailyBookingsList.innerHTML = cardsHTML;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
    function displayDailyBookings(selectedDate) {
        const allBookings = loadBookings();
        const dailyBookingsList = document.getElementById('dailyBookingsList');
        const dailyCount = document.getElementById('dailyCount');
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
        const filteredRecords = allBookings
            .filter(record => 
                record.BookingDate === selectedDate && 
                record.BookingId !== 'USER_REG' &&
                record.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' 
            )
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
            .sort((a, b) => a.BookingTime.localeCompare(b.BookingTime)); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ 09:00 -> 11:00

        dailyCount.textContent = `üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${selectedDate}: ${filteredRecords.length} ‡∏Ñ‡∏¥‡∏ß`;

        if (filteredRecords.length === 0) {
            dailyBookingsList.innerHTML = `
                <p style="text-align: center; color: #6c757d; padding: 20px; border: 1px dashed #ccc; border-radius: 8px;">
                    ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                </p>`;
            return;
        }

        let cardsHTML = '';
        filteredRecords.forEach(record => {
            const actionButton = `<button class="action-btn btn-disabled" style="margin-top: 10px; background-color: #28a745;">
                    <i class="fas fa-check-double"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                </button>`;

            cardsHTML += `
                <div class="daily-booking-card">
                    <div class="card-time">
                        ${record.BookingTime} ‡∏ô.
                        <div class="status-badge status-‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß" style="font-size: 0.5em; margin-top: 5px; display: block;">${record.Status}</div>
                    </div>
                    <div class="card-details">
                        <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏¥‡∏ß:</strong> ${record.BookingId}</p>
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</strong> ${record.OwnerName} (<span style="color: #007bff;">${record.OwnerTel}</span>)</p>
                        <p><strong>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</strong> ${record.ServiceType}</p>
                        <p style="font-size: 0.9em; color: #6c757d;">
                            <i class="fas fa-paw"></i> ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á: ${record.PetName}
                        </p>
                        ${actionButton}
                    </div>
                </div>
            `;
        });

        dailyBookingsList.innerHTML = cardsHTML;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ #members)
    function displayMemberProfiles(searchTerm = '') {
        const allBookings = loadBookings();
        const memberProfilesList = document.getElementById('memberProfilesList');
        const memberCount = document.getElementById('memberCount');

        // 1. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å (Registered records)
        const profilesMap = new Map();

        allBookings.forEach(record => {
            if (!record.OwnerTel) return;

            const tel = record.OwnerTel;

            if (!profilesMap.has(tel)) {
                // Initial Profile Data 
                profilesMap.set(tel, {
                    OwnerName: record.OwnerName,
                    OwnerEmail: record.OwnerEmail || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•', 
                    OwnerTelDisplay: record.OwnerTel,
                    Bookings: [],
                    Pets: new Set()
                });
            }

            const profile = profilesMap.get(tel);
            
            // Add Pet Name and Booking Record (exclude USER_REG for brevity in the list)
            if (record.BookingId !== 'USER_REG') {
                 if (record.PetName && record.PetName !== 'N/A') {
                     profile.Pets.add(`${record.PetName} (${record.PetSpecies || '-'})`);
                 }
                profile.Bookings.push(record);
            }
        });

        let profilesArray = Array.from(profilesMap.values());
        
        // 2. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        if (searchTerm) {
            const lowerCaseSearch = searchTerm.toLowerCase();
            profilesArray = profilesArray.filter(profile => 
                profile.OwnerName.toLowerCase().includes(lowerCaseSearch) ||
                profile.OwnerTelDisplay.includes(lowerCaseSearch) ||
                profile.OwnerEmail.toLowerCase().includes(lowerCaseSearch) ||
                Array.from(profile.Pets).some(pet => pet.toLowerCase().includes(lowerCaseSearch))
            );
        }

        memberCount.textContent = `üë§ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${profilesArray.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

        if (profilesArray.length === 0) {
            memberProfilesList.innerHTML = `
                <p style="text-align: center; color: #6c757d; padding: 20px; border: 1px dashed #ccc; border-radius: 8px;">
                    ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
                </p>`;
            return;
        }

        let cardsHTML = '';
        profilesArray.forEach(profile => {
            const petList = Array.from(profile.Pets).join(', ') || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á';
            
            // Sort bookings by date descending
            profile.Bookings.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));
            
            const latestBooking = profile.Bookings[0] ? 
                `‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${profile.Bookings[0].BookingDate} (${profile.Bookings[0].ServiceType}, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${profile.Bookings[0].Status})` : 
                '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß';

            cardsHTML += `
                <div class="user-profile-box" style="background: #f7f9fb; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h3 style="color: #004d99; border-bottom: 2px solid #004d99; padding-bottom: 5px; margin-bottom: 10px;">
                        <i class="fas fa-id-badge"></i> ${profile.OwnerName}
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <p><strong><i class="fas fa-phone"></i> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> ${profile.OwnerTelDisplay}</p>
                        <p><strong><i class="fas fa-envelope"></i> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${profile.OwnerEmail}</p>
                        <p style="grid-column: 1 / 3;"><strong><i class="fas fa-paw"></i> ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:</strong> ${petList}</p>
                        <p style="grid-column: 1 / 3; font-size: 0.9em; color: #6c757d;">
                             <strong><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</strong> ${profile.Bookings.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${latestBooking})
                        </p>
                    </div>
                </div>
            `;
        });

        memberProfilesList.innerHTML = cardsHTML;
    }


    function checkBookingLimit(date, time) {
        const bookings = loadBookings();
        const count = bookings.filter(record => 
            record.BookingDate === date && record.BookingTime === time && record.BookingId !== 'USER_REG'
        ).length;
        return count >= MAX_BOOKINGS_PER_HOUR;
    }
    
    // **********************************************
    // 6. Event Listeners (Form validation and submission)
    // **********************************************
    
    function validateForm(formData) {
        let isValid = true;
        const nameRegex = /^[‡∏Å-‡πôa-zA-Z\s]+$/;
        const telRegex = /^[0-9]{9,10}$/;
        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        
        document.getElementById('ownerNameError').textContent = '';
        document.getElementById('ownerTelError').textContent = '';
        document.getElementById('ownerEmailError').textContent = '';

        if (!formData.ownerName || !nameRegex.test(formData.ownerName)) {
            document.getElementById('ownerNameError').textContent = '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            isValid = false;
        }
        
        if (!formData.ownerTel || !telRegex.test(formData.ownerTel)) {
            document.getElementById('ownerTelError').textContent = '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9-10 ‡∏´‡∏•‡∏±‡∏Å';
            isValid = false;
        }
        
        if (!formData.ownerEmail || !emailRegex.test(formData.ownerEmail)) {
            document.getElementById('ownerEmailError').textContent = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            isValid = false;
        }
        
        if (formData.bookingDate && formData.bookingTime && checkBookingLimit(formData.bookingDate, formData.bookingTime)) {
            alert(`‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formData.bookingDate} ‡πÄ‡∏ß‡∏•‡∏≤ ${formData.bookingTime} ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≥‡∏Å‡∏±‡∏î ${MAX_BOOKINGS_PER_HOUR} ‡∏Ñ‡∏¥‡∏ß)`);
            isValid = false;
        }
        
        return isValid;
    }

    bookingForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (bookingFormFieldset.disabled) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß');
            showPage('login');
            return;
        }

        const form = e.target;
        const formData = {};
        const elements = form.elements;
        
        for (let i = 0; i < elements.length; i++) {
          const item = elements[i];
          if (item.name) {
            formData[item.name] = document.getElementById(item.id)?.value || item.value.trim();
          }
        }
        
        if (!validateForm(formData)) {
            return;
        }

        document.getElementById('loading').style.display = 'block';

        setTimeout(() => {
            const response = simulateProcessForm(formData);
            if (response.success) {
                showPage('confirmation', response.bookingId);
                
                document.getElementById('petName').value = '';
                document.getElementById('petSpecies').value = '';
                document.getElementById('petBreed').value = '';
                document.getElementById('serviceType').value = '';
                document.getElementById('bookingDate').value = '';
                document.getElementById('bookingTime').value = '';
                document.getElementById('notes').value = '';
                
                prefillBookingForm(getUserSession());
            }
            document.getElementById('loading').style.display = 'none';
        }, 1000); 
    });

</script>
</body>
</html>
